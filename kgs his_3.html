<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History Foundation - üòáPULY‚ù§Ô∏èSTARüòá</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: linear-gradient(to bottom, #fff5f5, #ffe4e1);
            text-align: center;
            position: relative;
            overflow-x: hidden;
        }
        .header {
            margin-bottom: 20px;
        }
        .header h1 {
            color: #ff4444;
            cursor: pointer;
            font-size: 2.5em;
            margin: 10px 0;
        }
        .header h1:hover {
            text-decoration: underline;
        }
        .header h2 {
            color: #333;
            font-size: 1.8em;
            margin: 10px 0;
        }
        .header img {
            width: 100%;
            max-width: 800px;
            border-radius: 10px;
            margin-top: 10px;
            border: 2px solid #ff69b4;
        }
        .tabs {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background-color: #ff69b4;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2em;
            color: #fff;
            transition: background 0.3s;
        }
        .tab.active {
            background-color: #ff4444;
        }
        .tab:hover {
            background-color: #ff1493;
        }
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .video-list .item, .notes-list .item {
            margin: 10px auto;
            padding: 10px;
            background: linear-gradient(to right, #fff, #ffe4e1);
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .video-list .item img, .notes-list .item img {
            width: 150px;
            height: 90px;
            border-radius: 5px;
            object-fit: cover;
        }
        .video-list .item .content, .notes-list .item .content {
            flex: 1;
        }
        .video-list .item span, .notes-list .item span {
            font-size: 1.2em;
            color: #333;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: block;
        }
        .video-list .item .credit, .notes-list .item .credit {
            font-size: 0.9em;
            color: #ff1493;
            margin-top: 5px;
        }
        .notes-list .item .file-info {
            font-size: 0.9em;
            color: #555;
            margin-top: 5px;
        }
        .modal-player {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-player.active {
            display: flex;
        }
        .modal-player .player-content {
            background: linear-gradient(to right, #fff, #ffe4e1);
            padding: 15px;
            border-radius: 8px;
            max-width: 700px;
            width: 90%;
        }
        .modal-player h3 {
            margin: 0 0 5px;
            font-size: 1.5em;
            color: #333;
        }
        .modal-player .credit {
            font-size: 1em;
            color: #ff1493;
            margin-bottom: 10px;
        }
        .modal-player .data-usage {
            font-size: 0.9em;
            color: #555;
            margin-bottom: 10px;
        }
        video {
            width: 100%;
            max-width: 600px;
            border-radius: 5px;
            border: 2px solid #ff69b4;
        }
        .button-container {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }
        .download-btn, .play-btn, .copy-btn, .default-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            text-decoration: none;
            display: inline-block;
        }
        .download-btn, .default-btn {
            background-color: #ff69b4;
            color: #fff;
        }
        .download-btn:hover, .default-btn:hover {
            background-color: #ff1493;
        }
        .play-btn {
            background-color: #ff4444;
            color: #fff;
        }
        .play-btn:hover {
            background-color: #cc0000;
        }
        .copy-btn {
            background-color: #ff69b4;
            color: #fff;
        }
        .copy-btn:hover {
            background-color: #ff1493;
        }
        .quality-selector {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px;
            position: relative;
            justify-content: center;
        }
        .quality-option {
            padding: 8px 16px;
            background-color: #ff69b4;
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s;
        }
        .quality-option:hover {
            background-color: #ff1493;
        }
        .quality-option.active {
            background-color: #ff4444;
        }
        .loader {
            position: absolute;
            bottom: 5px;
            height: 3px;
            background-color: #ff4444;
            transition: all 0.3s ease;
            z-index: 10;
        }
        .youtube-logo {
            position: fixed;
            bottom: 15px;
            left: 15px;
            z-index: 100;
            opacity: 0;
            animation: fadeInOut 8s infinite;
        }
        .youtube-logo img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            transition: transform 0.2s;
        }
        .youtube-logo img:hover {
            transform: scale(1.1);
        }
        #petals {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 99;
        }
        .petal {
            position: absolute;
            width: 20px;
            height: 20px;
            background: url('https://www.pngall.com/wp-content/uploads/2016/04/Rose-Petal-PNG-Clipart.png') no-repeat center;
            background-size: cover;
            opacity: 0.7;
            animation: fall 5s linear;
            display: none;
        }
        @keyframes fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 0.7;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            20%, 80% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="petals"></div>
    <div class="header">
        <h1 onclick="window.open('https://youtube.com/@starpranks09', '_blank')">‚ò†Ô∏èPULY‚ù§STAR‚ò†Ô∏è</h1>
        <h2>KHAN SIR HISTORY CLASSES</h2>
        <img src="https://i.ytimg.com/vi_webp/o1kEOHmAZ7Q/sddefault.webp" alt="Khan Sir History Classes">
    </div>

    <div class="tabs">
        <div class="tab active" onclick="showSection('videos')">Videos</div>
        <div class="tab" onclick="showSection('notes')">Notes</div>
    </div>

    <div id="videos" class="section active">
        <div class="video-list"></div>
    </div>

    <div id="notes" class="section">
        <div class="notes-list"></div>
    </div>

    <div class="modal-player" id="modal-player">
        <div class="player-content">
            <h3 id="modal-player-title">History Lecture</h3>
            <div class="credit">By PULY STAR</div>
            <div class="data-usage" id="modal-player-data-usage"></div>
            <video id="modal-video" controls poster="https://i.ytimg.com/vi_webp/o1kEOHmAZ7Q/sddefault.webp"></video>
            <div class="quality-selector" id="quality-selector">
                <div class="quality-option" data-quality="720">720</div>
                <div class="quality-option" data-quality="360">360</div>
                <div class="loader" id="quality-loader"></div>
            </div>
            <div class="button-container">
                <a class="default-btn" id="default-btn" href="#" onclick="playDefault()">Default</a>
                <a class="download-btn" href="#" id="modal-download-btn">DOWNLOAD</a>
                <button class="play-btn" onclick="playNow()">Play</button>
                <button class="copy-btn" onclick="copyLink()">Copy Link</button>
            </div>
        </div>
    </div>

    <a class="youtube-logo" href="https://youtube.com/@starpranks09" target="_blank">
        <img src="https://yt3.googleusercontent.com/BCD6wsUKh9xKG8XPxBO6K7l0W9xpQmXQ7TeI_zPr2n4-2J2wtm03-C8WqNM6l73r8zeBiu4Dtw=s160-c-k-c0x00ffffff-no-rj" alt="PULY STAR YouTube">
    </a>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        const videoList = document.querySelector('.video-list');
        const notesList = document.querySelector('.notes-list');
        const modalPlayer = document.getElementById('modal-player');
        const modalVideo = document.getElementById('modal-video');
        const modalPlayerTitle = document.getElementById('modal-player-title');
        const modalPlayerDataUsage = document.getElementById('modal-player-data-usage');
        const qualitySelector = document.getElementById('quality-selector');
        const qualityLoader = document.getElementById('quality-loader');
        const modalDownloadBtn = document.getElementById('modal-download-btn');
        const defaultBtn = document.getElementById('default-btn');
        const petalsContainer = document.getElementById('petals');

        let currentLecture = null;
        let selectedQuality = null;
        let isDragging = false;
        let startX = 0;

        // PDF links, titles, and dates for notes 1‚Äì23
        const pdfLinks = {
            1: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-1/history-test-01.pdf', title: 'History Test 01', date: '' },
            2: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-2/ancient-history01.pdf', title: 'Ancient History 01', date: '' },
            3: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-3/baudh-and-jain-dharm.pdf', title: 'Baudh and Jain dharm', date: '' },
            4: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-4/indian-religion-mahajanpad-morya-vansh.pdf', title: 'Indian Religion+Mahajanpad+Morya Vansh', date: '' },
            5: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-5/ispk.pdf', title: '‡§Æ‡•ã‡§∞‡•ç‡§Ø‡•ã‡§§‡•ç‡§§‡§∞ ‡§ï‡§æ‡§≤ (ISPK)', date: '' },
            6: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-6/mauryotar-kal.pdf', title: 'Mauryotar kal', date: '' },
            7: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-7/sangam-kal.pdf', title: 'Sangam Kal', date: '' },
            8: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-8/dakshin-bharat-khan-sir-history.pdf', title: 'dakshin bharat khan sir history', date: '' },
            9: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-9/medieval-history.pdf', title: 'Medieval History', date: '' },
            10: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-10/vijay-nagar-bkhakti-kaal-mughal.pdf', title: 'Vijay Nagar+Bkhakti kaal+Mughal', date: '' },
            11: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-11/medievle-history-test.pdf', title: 'Medievle History Test', date: '' },
            12: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-12/maratha-samrajya.pdf', title: 'Maratha Samrajya', date: '' },
            13: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-13/major-small-states.pdf', title: '‡§™‡•ç‡§∞‡§Æ‡•Å‡§ñ ‡§õ‡•ã‡§ü‡•á ‡§∞‡§æ‡§ú‡•ç‡§Ø', date: '' },
            14: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-14/revolution-of-1857.pdf', title: 'Revolution of 1857', date: '' },
            15: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-15/1857-ki-kranti-2.pdf', title: '1857 ki kranti (2)', date: '' },
            16: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-16/bhartiya-rashtriya-congress.pdf', title: 'bhartiya rashtriya congress', date: '' },
            17: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-17/social-reform-organisation.pdf', title: 'Social Reform Organisation', date: '' },
            18: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-18/gandhi-era.pdf', title: '‡§ó‡§æ‡§Ç‡§ß‡•Ä ‡§Ø‡•Å‡§ó', date: '' },
            19: { url: 'https://kgs-v1.akamaized.net/kgs-test/Notes/history-recorded/note-19/crisp-prastav.pdf', title: 'Crisp Prastav', date: '' },
            20: { url: 'https://kgs-v2.akamaized.net/kgs-test/Notes/history-recorded/note-20/delhi-darbar.pdf', title: 'Delhi Darbar', date: '' },
            21: { url: 'https://kgs-v2.akamaized.net/kgs/do/pdfs/96d0b883-fade-44c7-93ce-0db05cd5c3fa.pdf', title: 'History Complete Notes', date: '04 Jul 2024' },
            22: { url: 'https://kgs.nyc3.digitaloceanspaces.com/pdfs/a453294c-4ccf-4922-9f25-f2c906ed9fb7.pdf', title: 'Indian Congress Session', date: '19 Dec 2024' },
            23: { url: 'https://kgs.nyc3.digitaloceanspaces.com/pdfs/12833f76-1af1-4c4d-b6e3-de213573139c.pdf', title: 'Modern History full Notes', date: '06 Jan 2025' }
        };

        // Placeholder PDF sizes (in MB) - updated dynamically if fetching succeeds
        const pdfSizes = {};

        // Video durations (placeholder: 40 min) and data usage
        const videoDataUsage = {
            '720': { perMin: 1.125, total: 1.125 * 40, label: 'High' }, // ~2.5 Mbps
            '360': { perMin: 0.3375, total: 0.3375 * 40, label: 'Low' } // ~0.75 Mbps
        };
        const videoDuration = 40; // Placeholder in minutes

        // Function to fetch PDF size
        async function fetchPdfSize(url, lecture) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                if (response.ok) {
                    const size = response.headers.get('content-length');
                    if (size) {
                        const sizeMB = (size / (1024 * 1024)).toFixed(2);
                        pdfSizes[lecture] = sizeMB;
                    } else {
                        pdfSizes[lecture] = 5; // Fallback
                        console.warn(`No content-length for PDF ${url}`);
                    }
                } else {
                    pdfSizes[lecture] = 5; // Fallback
                    console.warn(`Failed to fetch PDF ${url}: ${response.status}`);
                }
            } catch (e) {
                pdfSizes[lecture] = 5; // Fallback for CORS or other errors
                console.warn(`Error fetching PDF ${url}: ${e.message}`);
            }
            const noteItem = document.querySelector(`.notes-list .item[data-lecture="${lecture}"]`);
            if (noteItem) {
                const date = pdfLinks[lecture].date ? `, ${pdfLinks[lecture].date}` : '';
                noteItem.querySelector('.file-info').textContent = `Size: ~${pdfSizes[lecture]} MB${date}`;
            }
        }

        // Rose petals animation
        function createPetals() {
            for (let i = 0; i < 10; i++) {
                const petal = document.createElement('div');
                petal.className = 'petal';
                petal.style.left = Math.random() * 100 + 'vw';
                petal.style.animationDelay = Math.random() * 2 + 's';
                petalsContainer.appendChild(petal);
            }
            const petals = document.querySelectorAll('.petal');
            petals.forEach(petal => petal.style.display = 'block');
            setTimeout(() => {
                petals.forEach(petal => petal.remove());
            }, 3000);
        }
        setInterval(createPetals, 10000);

        // Populate video and notes lists
        for (let i = 1; i <= 126; i++) {
            // Videos
            const videoItem = document.createElement('div');
            videoItem.className = 'item';
            videoItem.dataset.lecture = i;
            videoItem.innerHTML = `
                <img src="https://i.ytimg.com/vi_webp/o1kEOHmAZ7Q/sddefault.webp" alt="Lecture-${i}">
                <div class="content">
                    <span>History Lecture-${i}</span>
                    <div class="credit">By PULY STAR</div>
                </div>
            `;
            videoItem.onclick = function() {
                currentLecture = i;
                modalPlayerTitle.textContent = `History Lecture-${i}`;
                modalPlayerDataUsage.textContent = `Duration: ~${videoDuration} min, Data: ~${videoDataUsage['720'].total.toFixed(2)} MB (High 720)`;
                selectedQuality = null;
                loadVideo(getDefaultM3u8Url(i));
                modalPlayer.classList.add('active');
                moveLoaderToQuality('720');
            };
            videoList.appendChild(videoItem);

            // Notes (only for 1‚Äì23)
            if (pdfLinks[i]) {
                const noteItem = document.createElement('div');
                noteItem.className = 'item';
                noteItem.dataset.lecture = i;
                const date = pdfLinks[i].date ? `, ${pdfLinks[i].date}` : '';
                noteItem.innerHTML = `
                    <img src="https://i.ytimg.com/vi_webp/o1kEOHmAZ7Q/sddefault.webp" alt="${pdfLinks[i].title}">
                    <div class="content">
                        <span>${pdfLinks[i].title}</span>
                        <div class="credit">By PULY STAR</div>
                        <div class="file-info">Size: ~${pdfSizes[i] || 5} MB${date}</div>
                    </div>
                `;
                noteItem.onclick = function() {
                    window.open(pdfLinks[i].url, '_blank');
                };
                notesList.appendChild(noteItem);
                fetchPdfSize(pdfLinks[i].url, i);
            }
        }

        // Quality selector swipe/tap
        qualitySelector.addEventListener('mousedown', startDrag);
        qualitySelector.addEventListener('touchstart', startDrag);
        document.addEventListener('mousemove', drag);
        document.addEventListener('touchmove', drag);
        document.addEventListener('mouseup', endDrag);
        document.addEventListener('touchend', endDrag);

        function startDrag(e) {
            isDragging = true;
            startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
        }

        function drag(e) {
            if (!isDragging) return;
            e.preventDefault();
            const x = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
            const delta = x - startX;
            qualitySelector.scrollLeft -= delta;
            startX = x;
            updateLoaderPosition();
        }

        function endDrag() {
            isDragging = false;
        }

        document.querySelectorAll('.quality-option').forEach(option => {
            option.addEventListener('click', function() {
                selectedQuality = this.dataset.quality;
                document.querySelectorAll('.quality-option').forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                moveLoaderToQuality(selectedQuality);
                if (currentLecture) {
                    loadVideo(getM3u8Url(currentLecture, selectedQuality));
                    modalPlayerDataUsage.textContent = `Duration: ~${videoDuration} min, Data: ~${videoDataUsage[selectedQuality].total.toFixed(2)} MB (${videoDataUsage[selectedQuality].label} ${selectedQuality})`;
                }
            });
        });

        function updateLoaderPosition() {
            const activeOption = document.querySelector('.quality-option.active') || document.querySelector('.quality-option[data-quality="720"]');
            moveLoaderToQuality(activeOption.dataset.quality);
        }

        function moveLoaderToQuality(quality) {
            const option = document.querySelector(`.quality-option[data-quality="${quality}"]`);
            if (option) {
                const rect = option.getBoundingClientRect();
                const parentRect = qualitySelector.getBoundingClientRect();
                qualityLoader.style.width = `${rect.width}px`;
                qualityLoader.style.left = `${rect.left - parentRect.left + qualitySelector.scrollLeft}px`;
            }
        }

        function playDefault() {
            if (currentLecture) {
                selectedQuality = null;
                loadVideo(getDefaultM3u8Url(currentLecture));
                modalPlayerDataUsage.textContent = `Duration: ~${videoDuration} min, Data: ~${videoDataUsage['720'].total.toFixed(2)} MB (High 720)`;
                document.querySelectorAll('.quality-option').forEach(opt => opt.classList.remove('active'));
                document.querySelector('.quality-option[data-quality="720"]').classList.add('active');
                moveLoaderToQuality('720');
            }
        }

        modalDownloadBtn.onclick = function() {
            if (!currentLecture) return false;
            const quality = selectedQuality || '720';
            const m3u8Url = selectedQuality ? getM3u8Url(currentLecture, quality) : getDefaultM3u8Url(currentLecture);
            try {
                window.location.href = `intent://${m3u8Url}#Intent;package=idm.internet.download.manager;scheme=https;end`;
            } catch (e) {
                navigator.clipboard.writeText(m3u8Url).then(() => {
                    alert(`"History Lecture-${currentLecture}" ‡§ï‡§æ ${quality} ‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ!\n‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ó‡§æ‡§á‡§°:\n1. 1DM (Internet Download Manager) ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç: https://play.google.com/store/apps/details?id=idm.internet.download.manager\n2. 1DM ‡§Æ‡•á‡§Ç ‡§≤‡§ø‡§Ç‡§ï ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç, TS ‡§∏‡•á‡§ó‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç, ‡§´‡§ø‡§∞ ffmpeg ‡§∏‡•á MP4 ‡§Æ‡•á‡§Ç ‡§ï‡§®‡•ç‡§µ‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§\n3. VLC Media Player ‡§Æ‡•á‡§Ç ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç ‚Üí "Convert/Save" ‚Üí MP4 ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç‡•§\n4. ‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§ü‡•Ç‡§≤ (hlsloader.com, castr.io) ‡§Æ‡•á‡§Ç ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§\n5. ffmpeg: ffmpeg -i "${m3u8Url}" -c copy "History Lecture-${currentLecture}.mp4"\n‡§ï‡•ç‡§µ‡§æ‡§≤‡§ø‡§ü‡•Ä: ${quality} (~${videoDataUsage[quality].total.toFixed(2)} MB)`);
                });
            }
            return false;
        };

        function copyLink() {
            if (!currentLecture) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á ‡§è‡§ï ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç!');
                return;
            }
            const quality = selectedQuality || '720';
            const m3u8Url = selectedQuality ? getM3u8Url(currentLecture, quality) : getDefaultM3u8Url(currentLecture);
            navigator.clipboard.writeText(m3u8Url).then(() => {
                alert(`"History Lecture-${currentLecture}" (${quality}) ‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ! (~${videoDataUsage[quality].total.toFixed(2)} MB)`);
            }).catch(() => {
                alert('‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø! ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø‡§Ø‡§æ‡§Å ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç‡•§');
            });
        }

        function playNow() {
            if (currentLecture) {
                const quality = selectedQuality || '720';
                const m3u8Url = selectedQuality ? getM3u8Url(currentLecture, quality) : getDefaultM3u8Url(currentLecture);
                loadVideo(m3u8Url);
                modalPlayerDataUsage.textContent = `Duration: ~${videoDuration} min, Data: ~${videoDataUsage[quality].total.toFixed(2)} MB (${videoDataUsage[quality].label} ${quality})`;
                modalVideo.play().catch(e => {
                    console.error(`Video playback failed: ${e.message}`);
                });
            }
        }

        function showSection(section) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelector(`#${section}`).classList.add('active');
            document.querySelector(`.tab[onclick="showSection('${section}')"]`).classList.add('active');
            modalPlayer.classList.remove('active');
            currentLecture = null;
            selectedQuality = null;
            modalPlayerDataUsage.textContent = '';
        }

        function getDefaultM3u8Url(lectureNumber) {
            return `https://kgs-v2.akamaized.net/kgs-test/history-foundation/l${lectureNumber}/l${lectureNumber}.m3u8`;
        }

        function getM3u8Url(lectureNumber, quality) {
            return `https://kgs-v2.akamaized.net/kgs-test/history-foundation/l${lectureNumber}/${quality}.m3u8`;
        }

        function loadVideo(m3u8Url) {
            if (Hls.isSupported()) {
                const hls = new Hls({
                    enableWorker: true,
                    lowLatencyMode: true,
                    backBufferLength: 90
                });
                hls.loadSource(m3u8Url);
                hls.attachMedia(modalVideo);
                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    console.log('HLS manifest loaded');
                });
                hls.on(Hls.Events.ERROR, (event, data) => {
                    console.error(`HLS error: ${data.type} - ${data.details}`);
                    if (data.fatal) {
                        switch (data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                hls.startLoad();
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                hls.recoverMediaError();
                                break;
                            default:
                                alert('thank you puly bhai');
                                break;
                        }
                    }
                });
            } else if (modalVideo.canPlayType('application/vnd.apple.mpegurl')) {
                modalVideo.src = m3u8Url;
                modalVideo.addEventListener('error', () => {
                    console.error('Native HLS error');
                    alert('thank you puly bhai');
                });
            } else {
                console.error('HLS not supported');
                alert('thank you puly bhai');
            }
        }

        modalVideo.addEventListener('play', function() {
            if (currentLecture) {
                const m3u8Url = selectedQuality ? getM3u8Url(currentLecture, selectedQuality) : getDefaultM3u8Url(currentLecture);
                loadVideo(m3u8Url);
            }
        }, { once: true });

        // Close modal on click outside
        modalPlayer.addEventListener('click', function(e) {
            if (e.target === modalPlayer) {
                modalPlayer.classList.remove('active');
                modalVideo.pause();
            }
        });
    </script>
</body>
</html>