<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Moni x Sanju Player</title>
  <style>
    :root {
      --primary-bg: linear-gradient(to bottom right, #2b1055, #7597de);
      --dark-bg: linear-gradient(to bottom right, #0a043c, #000000);
      --text-color: white;
      --dark-text: #e0e0e0;
      --header-bg: rgba(0, 0, 0, 0.3);
      --dark-header: rgba(0, 0, 0, 0.7);
      --button-bg: #ff7f50;
      --dark-button: #ff6347;
      --input-bg: white;
      --dark-input: #333;
      --accent-color: #00ffff;
      --shadow: 0 4px 10px rgba(0,0,0,0.5);
      --transition: all 0.3s ease;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--primary-bg);
      color: var(--text-color);
      transition: var(--transition);
      min-height: 100vh;
    }

    body.dark-mode {
      background: var(--dark-bg);
      color: var(--dark-text);
    }

    body.dark-mode header {
      background: var(--dark-header);
    }

    body.dark-mode .controls button {
      background: var(--dark-button);
    }

    body.dark-mode input[type="file"], 
    body.dark-mode input[type="text"] {
      background: var(--dark-input);
      color: white;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: var(--header-bg);
      font-size: 20px;
      transition: var(--transition);
      backdrop-filter: blur(5px);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .toggle-mode {
      cursor: pointer;
      font-size: 24px;
      transition: transform 0.3s ease;
    }

    .toggle-mode:hover {
      transform: scale(1.1);
    }

    .player-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    video {
      width: 100%;
      max-height: 70vh;
      background: black;
      box-shadow: var(--shadow);
      border-radius: 8px;
      transition: var(--transition);
    }

    .controls {
      text-align: center;
      margin: 15px 0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    .controls button {
      margin: 0;
      padding: 10px 15px;
      border: none;
      background: var(--button-bg);
      color: white;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      font-size: 14px;
      min-width: 80px;
    }

    .controls button:hover {
      filter: brightness(1.1);
      transform: translateY(-2px);
    }

    .quality-selector {
      margin: 10px auto;
      padding: 8px 12px;
      border-radius: 8px;
      background: rgba(255,255,255,0.2);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
    }

    .quality-selector select {
      padding: 5px;
      border-radius: 5px;
      border: none;
      background: rgba(255,255,255,0.8);
    }

    .list-section {
      display: flex;
      gap: 25px;
      flex-wrap: wrap;
      padding: 15px;
      justify-content: center;
    }

    .list {
      flex: 1;
      min-width: 250px;
      max-width: 400px;
      background: rgba(0,0,0,0.2);
      border-radius: 10px;
      padding: 15px;
      transition: var(--transition);
    }

    .list:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }

    .list h3 {
      margin-top: 0;
      border-bottom: 2px solid var(--accent-color);
      padding-bottom: 8px;
      display: inline-block;
    }

    a {
      display: block;
      margin: 8px 0;
      color: var(--accent-color);
      text-decoration: none;
      font-weight: bold;
      transition: var(--transition);
      padding: 5px;
      border-radius: 5px;
    }

    a:hover {
      background: rgba(0,255,255,0.1);
      padding-left: 10px;
    }

    .video-title-container {
      text-align: center;
      margin: 15px 0;
      padding: 10px;
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      animation: fadeIn 0.5s ease;
    }

    .video-title {
      font-size: 1.3rem;
      font-weight: bold;
      margin: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .video-subtitle {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-top: 5px;
    }

    footer {
      text-align: center;
      margin: 30px 0 10px;
      color: #ddd;
      font-size: 14px;
      padding: 15px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
    }

    input[type="file"], input[type="text"] {
      margin: 10px;
      padding: 12px 15px;
      width: 80%;
      max-width: 500px;
      border-radius: 8px;
      border: none;
      transition: var(--transition);
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    input[type="file"]:focus, 
    input[type="text"]:focus {
      outline: none;
      box-shadow: 0 0 0 2px var(--accent-color);
    }

    .search-container {
      position: relative;
      display: inline-block;
      width: 80%;
      max-width: 500px;
    }

    .search-container input {
      padding-left: 35px;
      width: 100%;
    }

    .search-container::before {
      content: "üîç";
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      z-index: 1;
    }

    .file-input-container {
      position: relative;
      display: inline-block;
      width: 80%;
      max-width: 500px;
    }

    .file-input-label {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <header>
    <span>Moni x Sanju Player</span>
    <span class="toggle-mode" onclick="toggleMode()">üåô</span>
  </header>
  
  <div class="player-container">
    <div style="text-align:center;">
      <div class="file-input-container">
        <span class="file-input-label">üìÅ</span>
        <input type="file" id="txtFile" accept=".txt" onchange="handleFile(event)" placeholder="Select playlist file" />
      </div>
      <input type="text" id="directLink" placeholder="üîó Paste video link to play directly" />
      <button onclick="playDirectLink()" style="margin-bottom:15px;">‚ñ∂Ô∏è Play Link</button>
      <div class="search-container">
        <input type="text" id="searchInput" oninput="filterTitles()" placeholder="Search by Title" />
      </div>
    </div>
    
    <div class="video-title-container">
      <h2 class="video-title" id="currentVideoTitle">Select a video to play</h2>
      <div class="video-subtitle" id="currentVideoQuality"></div>
    </div>
    
    <video id="videoPlayer" controls></video>
    
    <div class="controls">
      <div class="quality-selector" id="qualitySelector" style="display:none;">
        <span>Quality: </span>
        <select id="qualityOptions" onchange="changeQuality()">
          <option value="auto">Auto</option>
        </select>
      </div>
      <button onclick="skip(-15)">‚è™ 15s</button>
      <button onclick="togglePlayPause()">‚èØÔ∏è Play/Pause</button>
      <button onclick="skip(15)">‚è© 15s</button>
      <button onclick="prevVideo()">‚¨ÖÔ∏è Previous</button>
      <button onclick="nextVideo()">‚û°Ô∏è Next</button>
      <select id="speed" onchange="changeSpeed()">
        <option value="0.5">0.5x</option>
        <option value="1" selected>1x</option>
        <option value="1.5">1.5x</option>
        <option value="2">2x</option>
        <option value="3">3x</option>
        <option value="4">4x</option>
      </select>
    </div>
    
    <div class="list-section">
      <div class="list" id="videoList">
        <h3>üé• Videos</h3>
      </div>
      <div class="list" id="pdfList">
        <h3>üìÑ PDFs</h3>
      </div>
    </div>
  </div>
  
  <footer>
    All Rights Reserved By Sanjay Kagra | <a href="https://t.me/history_by_naveen_sir_rwa" target="_blank" rel="noopener">VISHALüòÅRAVAN</a> <a href="https://youtube.com/@Vlogsbyvishalravan" target="_blank" rel="noopener" style="font-size:12px;opacity:.85;margin-left:6px;">(YouTube backup)</a>
  </footer>

  <!-- Include CryptoJS for AES decryption -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  
  <script>
    let currentIndex = 0;
    let videoEntries = []; // Stores all video entries with complete titles
    let qualityOptions = {}; // Stores quality variants
    
    function toggleMode() {
      document.body.classList.toggle("dark-mode");
      const modeIcon = document.querySelector('.toggle-mode');
      modeIcon.textContent = document.body.classList.contains("dark-mode") ? '‚òÄÔ∏è' : 'üåô';
      localStorage.setItem('darkMode', document.body.classList.contains("dark-mode"));
    }
    
    // Check for saved dark mode preference
    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add("dark-mode");
      document.querySelector('.toggle-mode').textContent = '‚òÄÔ∏è';
    }
    
    function skip(seconds) {
      const vid = document.getElementById('videoPlayer');
      vid.currentTime += seconds;
    }
    
    function togglePlayPause() {
      const vid = document.getElementById('videoPlayer');
      if (vid.paused) {
        vid.play();
      } else {
        vid.pause();
      }
    }
    
    function changeSpeed() {
      const rate = document.getElementById("speed").value;
      const vid = document.getElementById("videoPlayer");
      vid.playbackRate = parseFloat(rate);
    }
    
    function resetSpeed() {
      document.getElementById("speed").value = "1";
      document.getElementById("videoPlayer").playbackRate = 1;
    }
    
    function prevVideo() {
      if (currentIndex > 0) {
        loadVideoByIndex(--currentIndex);
      } else {
        showNotification("This is the first video");
      }
    }
    
    function nextVideo() {
      if (currentIndex < videoEntries.length - 1) {
        loadVideoByIndex(++currentIndex);
      } else {
        showNotification("This is the last video");
      }
    }
    
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.textContent = message;
      notification.style.position = 'fixed';
      notification.style.bottom = '20px';
      notification.style.left = '50%';
      notification.style.transform = 'translateX(-50%)';
      notification.style.backgroundColor = 'rgba(0,0,0,0.7)';
      notification.style.color = 'white';
      notification.style.padding = '10px 20px';
      notification.style.borderRadius = '5px';
      notification.style.zIndex = '1000';
      notification.style.animation = 'fadeIn 0.3s ease';
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'fadeOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
      }, 2000);
    }
    
    function handleFile(event) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const lines = e.target.result.split('\n');
        const videoListElement = document.getElementById('videoList');
        const pdfListElement = document.getElementById('pdfList');
        
        videoListElement.innerHTML = '<h3>üé• Videos</h3>';
        pdfListElement.innerHTML = '<h3>üìÑ PDFs</h3>';
        videoEntries = [];
        qualityOptions = {};
        
        lines.forEach((line, i) => {
          line = line.trim();
          if (!line) return;
          
          // Split on first colon only to get complete title
          const colonPos = line.indexOf(':');
          if (colonPos === -1) return;
          
          const title = line.substring(0, colonPos).trim(); // COMPLETE title
          const link = line.substring(colonPos + 1).trim();
          
          // Check if PDF
          const ext = link.split('.').pop().toLowerCase();
          if (ext === 'pdf') {
            pdfListElement.innerHTML += `<a href="${link}" target="_blank">${title}</a>`;
            return;
          }
          
          // Handle ALL video entries with complete titles
          if (title.includes('|')) {
            // Quality variant - store with full title
            const videoIndex = videoEntries.length;
            
            if (!qualityOptions[videoIndex]) {
              qualityOptions[videoIndex] = [];
              videoEntries.push({ 
                title: title, // Full original title with quality info
                link: '' 
              });
            }
            
            qualityOptions[videoIndex].push({
              quality: title, // Now stores complete title as quality label
              url: link
            });
            
            if (qualityOptions[videoIndex].length === 1) {
              videoListElement.innerHTML += 
                `<a href="#" onclick="loadVideoByIndex(${videoIndex})">${title}</a>`;
            }
          } else {
            // Regular video - store with full title
            videoEntries.push({ 
              title: title,
              link: link 
            });
            videoListElement.innerHTML += 
              `<a href="#" onclick="loadVideoByIndex(${videoEntries.length - 1})">${title}</a>`;
          }
        });
        
        if (videoEntries.length > 0) {
          loadVideoByIndex(0);
          showNotification(`Loaded ${videoEntries.length} videos`);
        }
      };
      reader.readAsText(event.target.files[0]);
    }
    
    function playDirectLink() {
      const link = document.getElementById("directLink").value.trim();
      if (!link) {
        showNotification("Please enter a valid URL");
        return;
      }
      videoEntries.push({ 
        title: "Direct Link Video",
        link: link 
      });
      currentIndex = videoEntries.length - 1;
      loadVideoByIndex(currentIndex);
      showNotification("Playing direct link");
    }
    
    function loadVideoByIndex(index) {
      currentIndex = index;
      const entry = videoEntries[index];
      const qualitySelector = document.getElementById("qualitySelector");
      const qualityOptionsSelect = document.getElementById("qualityOptions");
      
      // ALWAYS show complete original title
      document.getElementById("currentVideoTitle").textContent = entry.title;
      document.getElementById("currentVideoQuality").textContent = '';
      
      // Reset playback speed to 1x when changing videos
      resetSpeed();
      
      // Reset quality selector
      qualityOptionsSelect.innerHTML = '<option value="auto">Auto</option>';
      qualitySelector.style.display = 'none';
      
      // Check if this video has multiple quality options
      if (qualityOptions[index]) {
        qualitySelector.style.display = 'inline-flex';
        
        // Add all quality options with complete titles
        qualityOptions[index].forEach((option, i) => {
          qualityOptionsSelect.innerHTML += `<option value="${i}">${option.quality}</option>`;
        });
        
        // Load the first quality by default
        qualityOptionsSelect.value = 0;
        const quality = qualityOptions[index][0];
        loadVideoSource(quality.url);
      } else {
        // Regular single-quality video
        loadVideoSource(entry.link);
      }
    }
    
    function loadVideoSource(src) {
      const vid = document.getElementById("videoPlayer");
      const isYT = src.includes("youtube.com") || src.includes("youtu.be");
      
      if (isYT) {
        vid.outerHTML = `<iframe width="100%" height="400" src="${src}" frameborder="0" allowfullscreen></iframe>`;
      } else {
        const decrypted = decryptIfNeeded(src);
        if (vid.src !== decrypted) {
          vid.src = decrypted;
          vid.load();
          vid.play().catch(e => showNotification("Error playing video"));
        }
        vid.scrollIntoView({ behavior: 'smooth' });
      }
    }
    
    function changeQuality() {
      const selectedQuality = document.getElementById("qualityOptions").value;
      if (selectedQuality === 'auto') return;
      
      const qualityIndex = parseInt(selectedQuality);
      const selectedOption = qualityOptions[currentIndex][qualityIndex];
      loadVideoSource(selectedOption.url);
    }
    
    function filterTitles() {
      const filter = document.getElementById("searchInput").value.toLowerCase();
      let visibleCount = 0;
      
      document.querySelectorAll(".list a").forEach(el => {
        const isVisible = el.innerText.toLowerCase().includes(filter);
        el.style.display = isVisible ? "block" : "none";
        if (isVisible) visibleCount++;
      });
      
      if (filter && visibleCount === 0) {
        showNotification("No matching videos found");
      }
    }
    
    function decryptIfNeeded(link) {
      if (!link.includes("*")) return link;
      
      try {
        const [encryptedUrl, keyStr] = link.split("*");
        const key = CryptoJS.enc.Utf8.parse('638udh3829162018');
        const iv = CryptoJS.enc.Utf8.parse('fedcba9876543210');
        
        // Base64 decode the encrypted URL
        const encryptedBytes = CryptoJS.enc.Base64.parse(encryptedUrl);
        const encryptedData = CryptoJS.lib.WordArray.create(encryptedBytes.words, encryptedBytes.sigBytes);
        
        // Decrypt using AES-CBC
        const decrypted = CryptoJS.AES.decrypt(
          { ciphertext: encryptedData },
          key,
          { iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }
        );
        
        // Convert to UTF-8 string
        const decryptedUrl = decrypted.toString(CryptoJS.enc.Utf8);
        
        if (!decryptedUrl) {
          console.error("Decryption failed - empty result");
          return link;
        }
        
        return decryptedUrl;
      } catch (e) {
        console.error("Decryption error:", e);
        showNotification("Error decrypting video link");
        return link;
      }
    }
    
    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      const vid = document.getElementById('videoPlayer');
      if (!vid) return;
      
      switch(e.key) {
        case ' ': togglePlayPause(); e.preventDefault(); break;
        case 'ArrowLeft': skip(-5); break;
        case 'ArrowRight': skip(5); break;
        case 'ArrowUp': vid.volume = Math.min(1, vid.volume + 0.1); break;
        case 'ArrowDown': vid.volume = Math.max(0, vid.volume - 0.1); break;
        case 'm': vid.muted = !vid.muted; break;
        case 'f': vid.requestFullscreen?.(); break;
      }
    });
  </script>
</body>
</html>